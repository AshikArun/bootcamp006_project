---
title: "Exploratory Visualization of US Domestic Flights in Year 2009 "
author: "Yunrou Gong (Crystal)"
date: "July 15, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

# Introduction
Airplane is one of the  main transportation tools for carring people to travel around the world. Last year,over 798 million air passengers were transported  include both domestic and international aircraft passengers of air carriers registered in the U.S.The number of passengers been carried was increased dramatically by around 72%, compared to that of year 1990. The air transport industry a vital engine of global socio-economic growth,  is considerably important for economic development, creating direct and indirect employment, supporting tourism and local businesses, and stimulating foreign investment and international trade. Moreover, it is also played an crucial part in population movement and world exploration.Due to the huge historical records of the flights, we are able to do population flow analysis to get the insight of the moving behaviour of people.  
This report will use the historical records of US domestic flights during the year of 2009 to do the following analysises:visualization the air trafic in each airport to predit which is the larger hub or transit airport. Secondly, to check how the air traffic fluctuate through the year 2009. Additionaly, the article is going to define the pattern of population movemoent in US by air.  

# Origin Data Set Description  

##Abstract:
The origin data set is over 3.5 million monthly domestic flight records from 1990 to 2009. Data are arranged as an adjacency list with metadata.

###Fields:  
Short name	Type	Description  
Origin	String	Three letter airport code of the origin airport  
Destination	String	Three letter airport code of the destination airport  
Origin City	String	Origin city name  
Destination City	String	Destination city name  
Passengers	Integer	Number of passengers transported from origin to destination  
Seats	Integer	Number of seats available on flights from origin to destination  
Flights	Integer	Number of flights between origin and destination (multiple records for one month, many with flights > 1)  
Distance	Integer	Distance (to nearest mile) flown between origin and destination  
Fly Date	Integer	The date (yyyymm) of flight  
Origin Population	Integer	Origin city's population as reported by US Census  
Destination Population	Integer	Destination city's population as reported by US Census    

###Snippet:  
MFR    RDM    Medford, OR    Bend, OR    0    0    1    156    200810    200298    157730  
AMA    EKO    Amarillo, TX    Elko, NV    124    124    1    858    199308    202960    40259  
TUS    EKO    Tucson, AZ    Elko, NV    112    124    1    658    199308    711392    40259  
AMA    EKO    Amarillo, TX    Elko, NV    115    124    1    858    199406    206315    41668  
ICT    EKO    Wichita, KS    Elko, NV    100    124    1    1007    199607    552884    45034  
SPS    EKO    Wichita Falls, TX    Elko, NV    122    124    1    1059    199603    147683    45034   

###Source(s)  
1.US Census Bureau  
2.RITA/Transtats, Bureau of Transportation Statistics  

Year: 2009

URL: http://www.infochimps.com/datasets/35-million-us-domestic-flights-from-1990-to-2009  

##Data Manipulation  

Bascially, The original data set is abstracted into only one year of 2009 and remove the rows that the origin airport and destination airport is the same. Additionaly, I also delete the rows with zero value in column "Passengers".

##Data set of Year 2009 
```{r flights, include=FALSE}
setwd("~/Desktop/FLIGHT/")
library(dplyr)
library(ggplot2)
library(maps)
library(googleVis)

year2009<- read.csv("year2009.csv")

```

```{r summary_year2009, echo=TRUE}

tbl_df(year2009)


```
### Accumulative flow of passengers at each airport in year 2009
First, I calculate the accumulative outflow of passengers by using summarise function in dyplr and arrange the data by descending value. However, the observations are still too mcuh to analysis, which has 445 distinguish airports in rows.

```{r year2009_2, include=FALSE}
#Origin airport by Passengers_out
year2009_2<- year2009%>%group_by(Origin)%>%
  summarise(Passengers_out=sum(Passengers),flights_out=sum(Flights))%>%
  arrange(desc(Passengers_out))

```

```{r show_year2009_2, echo=TRUE}
str(year2009_2)
```

Thus, I choose to filter the origin airport within the top 15 number of Passengers and plot it into bar chart. 
```{r top10outflow, echo=FALSE}
top15_Origin<-year2009_2[1:15,]
  
# bar chart of top15 origin airport by Passengers_out
top15outflow.plot<-ggplot(data=top15_Origin,aes(x=reorder(Origin,-Passengers_out)))+
  geom_bar(aes(y=Passengers_out,fill=Origin),stat = "identity")

top15outflow.plot<-top15outflow.plot+labs(
  title="Top 15 Accumulative Outflow of Passengers from Origin Airport",
  x="Origin Airport",
  y="Number of Passengers Outflow")

top15outflow.plot 

```

Meanwhile, filter the year 2009 data to get the destinaiton airport within top 15 inflow of passengers.  

```{r Destination Airport, echo=FALSE}

#choose the top 15 Dstination airport by Passengers_in
year2009_3<- year2009%>%group_by(Destination)%>%
  summarise(Passengers_in=sum(Passengers),flights_in=sum(Flights))%>%
  arrange(desc(Passengers_in))
top15_Destination<-year2009_3[1:15,]

# bar chart of top10 origin airport by Passengers_out
top15inflow.plot<-ggplot(data=top15_Destination,aes(x=reorder(Destination,-Passengers_in)))+
  geom_bar(aes(y=Passengers_in,fill=Destination),stat = "identity")

top15inflow.plot<-top15inflow.plot+labs(
  title="Top 15 Accumulative Inflow of Passengers to Destination Airport",
  x="Destination Airport",
  y="Number of Passengers Inflow")

top15inflow.plot  


```

Compare the above two barcharts, it is easily to find out that the names of the origin airport are exact the same as the names of destination airport. In other words, the net passengers flow for each airport may approxiemately to zero. Take a further look into the Jackson Atlanta International Airport(ATL), it ranks at the first both of the total outflow and total inflow, which is make sense as the ATL is a large hub airport, also a transit airport.

##Explore the Variation of Air Traffic Volume during the Year 2009

Secondly, make a line polt to visialize the fluctuation of the air traffic load during the year of 2009. According to the monthly traffic chart below, we will find out that the traffic volume reaches the peak at July. The reason of that I guess is because of Independence day and summer holiday season. 

```{r air traffic peak, echo=FALSE, results="asis"}
###trafic peak within year 2009 

monthly_traffic_load<- year2009 %>% group_by(Month)%>%
  summarise(.,Flights=sum(Flights))

monthly_traffic.gplot<-gvisAreaChart(
  data=monthly_traffic_load,xvar = "Month",yvar="Flights",
  options=list(colors="#99ccff",
               width="1000px", height="500px",
               vAxes="[{title:'Volume of Flights'}]",
               hAxes="[{title:'Month'}]",
               title="Monthly Traffic in 2009",
               titleTextStyle="{fontSize:18}",
               legend="{position:'Top'}"))
plot(monthly_traffic.gplot,"chart")

```


```{r subsetdf_netflow, warning=TRUE, include=FALSE, results="asis"}

#create month 12 df

month12<-filter(year2009,Month==12)
# summarise the total passengers_out for each origin airport 
month12_origin <- month12 %>% group_by(Origin) %>%
  summarise(Passengers_out=sum(Passengers),Flight_out=sum(Flights),
            Origin.Population=mean(Origin.Population))
#summarise the total passengers_in for each destination airport 
month12_destination <- month12%>% group_by(Destination) %>%
  summarise(Passengers_in=sum(Passengers),Flight_in=sum(Flights),
            Destination.Population=mean(Destination.Population))

#Merge the month11_Origin and month11_Destination, calculate and rank 
#the net flow of Passengers
month12_netflow_passengers<-
  merge(month12_origin,month12_destination,
        by.x="Origin",by.y="Destination")
month12_df<-month12_netflow_passengers%>%
  mutate(Netflow_Passengers=Passengers_in-Passengers_out)%>%
  arrange(desc(Netflow_Passengers))

month12_df<-month12_df%>% 
  select(Airport=Origin,Passengers_out,Passengers_in,
         CityPopulation=Origin.Population,Netflow_Passengers)


#create month 11 df

month11<-filter(year2009,Month==11)
# summarise the total passengers_out for each origin airport 
month11_origin <- month11 %>% group_by(Origin) %>%
  summarise(Passengers_out=sum(Passengers),Flight_out=sum(Flights),
            Origin.Population=mean(Origin.Population))
#summarise the total passengers_in for each destination airport 
month11_destination <- month11%>% group_by(Destination) %>%
  summarise(Passengers_in=sum(Passengers),Flight_in=sum(Flights),
            Destination.Population=mean(Destination.Population))

#Merge the month11_Origin and month11_Destination, calculate and rank 
#the net flow of Passengers
month11_netflow_passengers<-merge(month11_origin,month11_destination,
                                  by.x="Origin", by.y="Destination")
month11_df<-month11_netflow_passengers%>%
  mutate(Netflow_Passengers=Passengers_in-Passengers_out)%>%
  arrange(desc(Netflow_Passengers))

month11_df<-month11_df%>% 
  select(Airport=Origin,Passengers_out,Passengers_in,
         CityPopulation=Origin.Population,Netflow_Passengers)

#write.csv(month11_df,file="month11_df.csv",row.names = F)

#create month 10 df
month10<-filter(year2009,Month==10)
# summarise the total passengers_out for each origin airport 
month10_origin <- month10 %>% group_by(Origin) %>%
  summarise(Passengers_out=sum(Passengers),Flight_out=sum(Flights),
            Origin.Population=mean(Origin.Population))
#summarise the total passengers_in for each destination airport 
month10_destination <- month10%>% group_by(Destination) %>%
  summarise(Passengers_in=sum(Passengers),Flight_in=sum(Flights),
            Destination.Population=mean(Destination.Population))

#Merge the month10_Origin and month10_Destination, calculate and rank 
#the net flow of Passengers
month10_netflow_passengers<-merge(month10_origin,month10_destination,by.x="Origin",
                                  by.y="Destination")
month10_df<-month10_netflow_passengers%>%
  mutate(Netflow_Passengers=Passengers_in-Passengers_out)%>%
  arrange(desc(Netflow_Passengers))

month10_df<-month10_df%>% 
  select(Airport=Origin,Passengers_out,Passengers_in,
         CityPopulation=Origin.Population,Netflow_Passengers)

#write.csv(month10_df,file="month10_df.csv",row.names = F)

#create month 9 df
month9<-filter(year2009,Month==9)
# summarise the total passengers_out for each origin airport 
month9_origin <- month9 %>% group_by(Origin) %>%
  summarise(Passengers_out=sum(Passengers),Flight_out=sum(Flights),
            Origin.Population=mean(Origin.Population))
#summarise the total passengers_in for each destination airport 
month9_destination <- month9%>% group_by(Destination) %>%
  summarise(Passengers_in=sum(Passengers),Flight_in=sum(Flights),
            Destination.Population=mean(Destination.Population))

#Merge the month9_Origin and month9_Destination, calculate and rank 
#the net flow of Passengers
month9_netflow_passengers<-merge(month9_origin,month9_destination,by.x="Origin",
                                  by.y="Destination")
month9_df<-month9_netflow_passengers%>%
  mutate(Netflow_Passengers=Passengers_in-Passengers_out)%>%
  arrange(desc(Netflow_Passengers))

month9_df<-month9_df%>% 
  select(Airport=Origin,Passengers_out,Passengers_in,
         CityPopulation=Origin.Population,Netflow_Passengers)

#write.csv(month9_df,file="month9_df.csv",row.names = F)


#create month 8 df
month8<-filter(year2009,Month==8)
# summarise the total passengers_out for each origin airport 
month8_origin <- month8 %>% group_by(Origin) %>%
  summarise(Passengers_out=sum(Passengers),Flight_out=sum(Flights),
            Origin.Population=mean(Origin.Population))
#summarise the total passengers_in for each destination airport 
month8_destination <- month8%>% group_by(Destination) %>%
  summarise(Passengers_in=sum(Passengers),Flight_in=sum(Flights),
            Destination.Population=mean(Destination.Population))

#Merge the month8_Origin and month8_Destination, calculate and rank 
#the net flow of Passengers
month8_netflow_passengers<-merge(month8_origin,month8_destination,by.x="Origin",
                                 by.y="Destination")
month8_df<-month8_netflow_passengers%>%
  mutate(Netflow_Passengers=Passengers_in-Passengers_out)%>%
  arrange(desc(Netflow_Passengers))

month8_df<-month8_df%>% 
  select(Airport=Origin,Passengers_out,Passengers_in,
         CityPopulation=Origin.Population,Netflow_Passengers)

#write.csv(month8_df,file="month8_df.csv",row.names = F)


#create month 7 df
month7<-filter(year2009,Month==7)
# summarise the total passengers_out for each origin airport 
month7_origin <- month7 %>% group_by(Origin) %>%
  summarise(Passengers_out=sum(Passengers),Flight_out=sum(Flights),
            Origin.Population=mean(Origin.Population))
#summarise the total passengers_in for each destination airport 
month7_destination <- month7%>% group_by(Destination) %>%
  summarise(Passengers_in=sum(Passengers),Flight_in=sum(Flights),
            Destination.Population=mean(Destination.Population))

#Merge the month7_Origin and month7_Destination, calculate and rank 
#the net flow of Passengers
month7_netflow_passengers<-merge(month7_origin,month7_destination,by.x="Origin",
                                 by.y="Destination")
month7_df<-month7_netflow_passengers%>%
  mutate(Netflow_Passengers=Passengers_in-Passengers_out)%>%
  arrange(desc(Netflow_Passengers))

month7_df<-month7_df%>% 
  select(Airport=Origin,Passengers_out,Passengers_in,
         CityPopulation=Origin.Population,Netflow_Passengers)


#write.csv(month7_df,file="month7_df.csv",row.names = F)



#create month 6 df
month6<-filter(year2009,Month==6)
# summarise the total passengers_out for each origin airport 
month6_origin <- month6 %>% group_by(Origin) %>%
  summarise(Passengers_out=sum(Passengers),Flight_out=sum(Flights),
            Origin.Population=mean(Origin.Population))
#summarise the total passengers_in for each destination airport 
month6_destination <- month6%>% group_by(Destination) %>%
  summarise(Passengers_in=sum(Passengers),Flight_in=sum(Flights),
            Destination.Population=mean(Destination.Population))

#Merge the month6_Origin and month6_Destination, calculate and rank 
#the net flow of Passengers
month6_netflow_passengers<-merge(month6_origin,month6_destination,by.x="Origin",
                                 by.y="Destination")
month6_df<-month6_netflow_passengers%>%
  mutate(Netflow_Passengers=Passengers_in-Passengers_out)%>%
  arrange(desc(Netflow_Passengers))

month6_df<-month6_df%>% 
  select(Airport=Origin,Passengers_out,Passengers_in,
         CityPopulation=Origin.Population,Netflow_Passengers)

#write.csv(month6_df,file="month6_df.csv",row.names = F)


#create month 5 df
month5<-filter(year2009,Month==5)
# summarise the total passengers_out for each origin airport 
month5_origin <- month5 %>% group_by(Origin) %>%
  summarise(Passengers_out=sum(Passengers),Flight_out=sum(Flights),
            Origin.Population=mean(Origin.Population))
#summarise the total passengers_in for each destination airport 
month5_destination <- month5%>% group_by(Destination) %>%
  summarise(Passengers_in=sum(Passengers),Flight_in=sum(Flights),
            Destination.Population=mean(Destination.Population))

#Merge the month5_Origin and month5_Destination, calculate and rank 
#the net flow of Passengers
month5_netflow_passengers<-merge(month5_origin,month5_destination,by.x="Origin",by.y="Destination")
month5_df<-month5_netflow_passengers%>%
  mutate(Netflow_Passengers=Passengers_in-Passengers_out)%>%
  arrange(desc(Netflow_Passengers))

month5_df<-month5_df%>% 
  select(Airport=Origin,Passengers_out,Passengers_in,
         CityPopulation=Origin.Population,Netflow_Passengers)

#write.csv(month5_df,file="month5_df.csv",row.names = F)


#create month 4 df
month4<-filter(year2009,Month==4)
# summarise the total passengers_out for each origin airport 
month4_origin <- month4 %>% group_by(Origin) %>%
  summarise(Passengers_out=sum(Passengers),Flight_out=sum(Flights),
            Origin.Population=mean(Origin.Population))
#summarise the total passengers_in for each destination airport 
month4_destination <- month4%>% group_by(Destination) %>%
  summarise(Passengers_in=sum(Passengers),Flight_in=sum(Flights),
            Destination.Population=mean(Destination.Population))

#Merge the month4_Origin and month4_Destination, calculate and rank 
#the net flow of Passengers
month4_netflow_passengers<-merge(month4_origin,month4_destination,by.x="Origin", by.y="Destination")
month4_df<-month4_netflow_passengers%>%
  mutate(Netflow_Passengers=Passengers_in-Passengers_out)%>%
  arrange(desc(Netflow_Passengers))

month4_df<-month4_df%>% 
  select(Airport=Origin,Passengers_out,Passengers_in,
         CityPopulation=Origin.Population,Netflow_Passengers)

#write.csv(month4_df,file="month4_df.csv",row.names = F)



#create month 3 df
month3<-filter(year2009,Month==3)
# summarise the total passengers_out for each origin airport 
month3_origin <- month3 %>% group_by(Origin) %>%
  summarise(Passengers_out=sum(Passengers),Flight_out=sum(Flights),
            Origin.Population=mean(Origin.Population))
#summarise the total passengers_in for each destination airport 
month3_destination <- month3%>% group_by(Destination) %>%
  summarise(Passengers_in=sum(Passengers),Flight_in=sum(Flights),
            Destination.Population=mean(Destination.Population))

#Merge the month3_Origin and month3_Destination, calculate and rank 
#the net flow of Passengers
month3_netflow_passengers<-merge(month3_origin,month3_destination,by.x="Origin",by.y="Destination")
month3_df<-month3_netflow_passengers%>%
  mutate(Netflow_Passengers=Passengers_in-Passengers_out)%>%
  arrange(desc(Netflow_Passengers))

month3_df<-month3_df%>% 
  select(Airport=Origin,Passengers_out,Passengers_in,
         CityPopulation=Origin.Population,Netflow_Passengers)

#write.csv(month3_df,file="month3_df.csv",row.names = F)


#create month 2 df
month2<-filter(year2009,Month==2)
# summarise the total passengers_out for each origin airport 
month2_origin <- month2 %>% group_by(Origin) %>%
  summarise(Passengers_out=sum(Passengers),Flight_out=sum(Flights),
            Origin.Population=mean(Origin.Population))
#summarise the total passengers_in for each destination airport 
month2_destination <- month2%>% group_by(Destination) %>%
  summarise(Passengers_in=sum(Passengers),Flight_in=sum(Flights),
            Destination.Population=mean(Destination.Population))

#Merge the month2_Origin and month2_Destination, calculate and rank 
#the net flow of Passengers
month2_netflow_passengers<-merge(
  month2_origin,
  month2_destination,
  by.x="Origin",by.y="Destination")
month2_df<-month2_netflow_passengers%>%
  mutate(Netflow_Passengers=Passengers_in-Passengers_out)%>%
  arrange(desc(Netflow_Passengers))

month2_df<-month2_df%>% 
  select(Airport=Origin,Passengers_out,Passengers_in,
         CityPopulation=Origin.Population,Netflow_Passengers)


# creaste month 1 df 
month1<-filter(year2009,Month==1)
# summarise the total passengers_out for each origin airport 
month1_origin <- month1 %>% group_by(Origin) %>%
  summarise(Passengers_out=sum(Passengers),Flight_out=sum(Flights),
            Origin.Population=mean(Origin.Population))
#summarise the total passengers_in for each destination airport 
month1_destination <- month1%>% group_by(Destination) %>%
  summarise(Passengers_in=sum(Passengers),Flight_in=sum(Flights),
            Destination.Population=mean(Destination.Population))

#Merge the month1_Origin and month1_Destination, calculate and rank 
#the net flow of Passengers
month1_netflow_passengers<-merge(month1_origin,month1_destination,by.x="Origin",by.y="Destination")
month1_df<-month1_netflow_passengers%>%
  mutate(Netflow_Passengers=Passengers_in-Passengers_out)%>%
  arrange(desc(Netflow_Passengers))

month1_df<-month1_df%>% 
  select(Airport=Origin,Passengers_out,Passengers_in,
         CityPopulation=Origin.Population,Netflow_Passengers)

#write.csv(month1_df,file="month1_df.csv",row.names = F)

# subset top 10 and last 10 of month12
month12_top10<-month12_df[1:10,]
month12_last10<-month12_df[344:353,]
month12_20<-rbind.data.frame(month12_top10,month12_last10)
month12_20<-arrange(month12_20,desc(Netflow_Passengers))
month12_20<-mutate(month12_20,netflow_sign= ifelse(
  month12_20$Netflow_Passengers<0,"More People out",ifelse(
    month12_20$Netflow_Passengers>0,"More People in","Neutral")))

# subset top 10 and last 10 of month11
month11_top10<-month11_df[1:10,]
month11_last10<-month11_df[336:345,]
month11_20<-rbind.data.frame(month11_top10,month11_last10)
month11_20<-arrange(month11_20,desc(Netflow_Passengers))
month11_20<-mutate(month11_20,netflow_sign= ifelse(
  month11_20$Netflow_Passengers<0,"More People out",ifelse(
    month11_20$Netflow_Passengers>0,"More People in","Neutral")))

# subset top 10 and last 10 of month10
month10_top10<-month10_df[1:10,]
month10_last10<-month10_df[336:345,]
month10_20<-rbind.data.frame(month10_top10,month10_last10)
month10_20<-arrange(month10_20,desc(Netflow_Passengers))
month10_20<-mutate(month10_20,netflow_sign= ifelse(
  month10_20$Netflow_Passengers<0,"More People out",ifelse(
    month10_20$Netflow_Passengers>0,"More People in","Neutral")))

# subset top 10 and last 10 of month 9
month9_top10<-month9_df[1:10,]
month9_last10<-month9_df[354:363,]
month9_20<-rbind.data.frame(month9_top10,month9_last10)
month9_20<-arrange(month9_20,desc(Netflow_Passengers))
month9_20<-mutate(month9_20,netflow_sign= ifelse(
  month9_20$Netflow_Passengers<0,"More People out",ifelse(
    month9_20$Netflow_Passengers>0,"More People in","Neutral")))


# subset top 10 and last 10 of month 8
month8_top10<-month8_df[1:10,]
month8_last10<-month8_df[342:351,]
month8_20<-rbind.data.frame(month8_top10,month8_last10)
month8_20<-arrange(month8_20,desc(Netflow_Passengers))
month8_20<-mutate(month8_20,netflow_sign= ifelse(
  month8_20$Netflow_Passengers<0,"More People out",ifelse(
    month8_20$Netflow_Passengers>0,"More People in","Neutral")))

# subset top 10 and last 10 of month 7
month7_top10<-month7_df[1:10,]
month7_last10<-month7_df[347:356,]
month7_20<-rbind.data.frame(month7_top10,month7_last10)
month7_20<-arrange(month7_20,desc(Netflow_Passengers))
month7_20<-mutate(month7_20,netflow_sign= ifelse(
  month7_20$Netflow_Passengers<0,"More People out",ifelse(
    month7_20$Netflow_Passengers>0,"More People in","Neutral")))

# subset top 10 and last 10 of month 6
month6_top10<-head(month6_df,10)
month6_last10<-tail(month6_df,10)
month6_20<-rbind.data.frame(month6_top10,month6_last10)
month6_20<-arrange(month6_20,desc(Netflow_Passengers))
month6_20<-mutate(month6_20,netflow_sign= ifelse(
  month6_20$Netflow_Passengers<0,"More People out",ifelse(
    month6_20$Netflow_Passengers>0,"More People in","Neutral")))

# subset top 10 and last 10 of month 5
month5_top10<-head(month5_df,10)
month5_last10<-tail(month5_df,10)
month5_20<-rbind.data.frame(month5_top10,month5_last10)
month5_20<-arrange(month5_20,desc(Netflow_Passengers))
month5_20<-mutate(month5_20,netflow_sign= ifelse(
  month5_20$Netflow_Passengers<0,"More People out",ifelse(
    month5_20$Netflow_Passengers>0,"More People in","Neutral")))

# subset top 10 and last 10 of month 4
month4_top10<-head(month4_df,10)
month4_last10<-tail(month4_df,10)
month4_20<-rbind.data.frame(month4_top10,month4_last10)
month4_20<-arrange(month4_20,desc(Netflow_Passengers))
month4_20<-mutate(month4_20,netflow_sign= ifelse(
  month4_20$Netflow_Passengers<0,"More People out",ifelse(
    month4_20$Netflow_Passengers>0,"More People in","Neutral")))


# subset top 10 and last 10 of month 3
month3_top10<-head(month3_df,10)
month3_last10<-tail(month3_df,10)
month3_20<-rbind.data.frame(month3_top10,month3_last10)
month3_20<-arrange(month3_20,desc(Netflow_Passengers))
month3_20<-mutate(month3_20,netflow_sign= ifelse(
  month3_20$Netflow_Passengers<0,"More People out",ifelse(
    month3_20$Netflow_Passengers>0,"More People in","Neutral")))


# subset top 10 and last 10 of month 2
month2_top10<-head(month2_df,10)
month2_last10<-tail(month2_df,10)
month2_20<-rbind.data.frame(month2_top10,month2_last10)
month2_20<-arrange(month2_20,desc(Netflow_Passengers))
month2_20<-mutate(month2_20,netflow_sign= ifelse(
  month2_20$Netflow_Passengers<0,"More People out",ifelse(
    month2_20$Netflow_Passengers>0,"More People in","Neutral")))


# subset top 10 and last 10 of month1
month1_top10<-month1_df[1:10,]
month1_last10<-month1_df[336:345,]
month1_20<-rbind.data.frame(month1_top10,month1_last10)
month1_20<-arrange(month1_20,desc(Netflow_Passengers))
month1_20<-mutate(month1_20,netflow_sign= ifelse(
  month1_20$Netflow_Passengers<0,"More People out",ifelse(
    month1_20$Netflow_Passengers>0,"More People in","Neutral")))


#googlevin plot of month 1

month1_20.Column <- gvisColumnChart(
  month1_20,xvar = "Airport",
  yvar =c("Netflow_Passengers"),
  options=list(hAxis="{title:'Airport',titleTextStyle:{color:'#003366',
               fontSize:16}}",
               vAxis="{title:'Quantity of Netflow Passengers',
               titleTextStyle:{color:'#003366',fontSize:16}}",
               colors="#FFCCFF",
               width="1000px", height="400px",
               title="Net Flow of Passengers in JAN.2009",
               titleTextStyle="{color:'#003366',fontName:'Arial',
               fontSize:18}",
               legend="{ position:'right'}"))
#plot(month1_20.Column,"chart")

#googlevin plot of month 2

month2_20.Column <- gvisColumnChart(
  month2_20,xvar = "Airport",
  yvar =c("Netflow_Passengers"),
  options=list(hAxis="{title:'Airport',titleTextStyle:{color:'#003366',
               fontSize:16}}",
               vAxis="{title:'Quantity of Netflow Passengers',
               titleTextStyle:{color:'#003366',fontSize:16}}",
               width="1000px", height="400px",
               title="Net Flow of Passengers in FEB.2009",
               titleTextStyle="{color:'#003366',fontName:'Arial',
               fontSize:18}",
               legend="{ position:'right'}",
               colors="#E6B8F0"))

#plot(month2_20.Column, 'chart')

#googlevin plot of month 3

month3_20.Column <- gvisColumnChart(
  month3_20,xvar = "Airport",
  yvar =c("Netflow_Passengers"),
  options=list(hAxis="{title:'Airport',titleTextStyle:{color:'#003366',
               fontSize:16}}",
               vAxis="{title:'Quantity of Netflow Passengers',
               titleTextStyle:{color:'#003366',fontSize:16}}",
               width="1000px", height="400px",
               title="Net Flow of Passengers in MAR.2009",
               titleTextStyle="{color:'#003366',fontName:'Arial',
               fontSize:18}",
               legend="{ position:'right'}",
               colors="#CCA3E0"))

#googlevin plot of month 4

month4_20.Column <- gvisColumnChart(
  month4_20,xvar = "Airport",
  yvar =c("Netflow_Passengers"),
  options=list(hAxis="{title:'Airport',titleTextStyle:{color:'#003366',
               fontSize:16}}",
               vAxis="{title:'Quantity of Netflow Passengers',
               titleTextStyle:{color:'#003366',fontSize:16}}",
               width="1000px", height="400px",
               title="Net Flow of Passengers in APR.2009",
               titleTextStyle="{color:'#003366',fontName:'Arial',
               fontSize:18}",
               legend="{ position:'right'}",
               colors="#B28FD1"))


#googlevin plot of month 5
month5_20.Column <- gvisColumnChart(
  month5_20,xvar = "Airport",
  yvar =c("Netflow_Passengers"),
  options=list(hAxis="{title:'Airport',titleTextStyle:{color:'#003366',
               fontSize:16}}",
               vAxis="{title:'Quantity of Netflow Passengers',
               titleTextStyle:{color:'#003366',fontSize:16}}",
               width="1000px", height="400px",
               title="Net Flow of Passengers in MAY.2009",
               titleTextStyle="{color:'#003366',fontName:'Arial',
               fontSize:18}",
               legend="{ position:'right'}",
               colors="#997AC2"))

#googlevin plot of month 6
month6_20.Column <- gvisColumnChart(
  month6_20,xvar = "Airport",
  yvar =c("Netflow_Passengers"),
  options=list(hAxis="{title:'Airport',titleTextStyle:{color:'#003366',
               fontSize:16}}",
               vAxis="{title:'Quantity of Netflow Passengers',
               titleTextStyle:{color:'#003366',fontSize:16}}",
               width="1000px", height="400px",
               title="Net Flow of Passengers in JUN.2009",
               titleTextStyle="{color:'#003366',fontName:'Arial',
               fontSize:18}",
               legend="{ position:'right'}",
               colors="#8066B2"))

#googlevin plot of month 7
month7_20.Column <- gvisColumnChart(
  month7_20,xvar = "Airport",
  yvar =c("Netflow_Passengers"),
  options=list(hAxis="{title:'Airport',titleTextStyle:{color:'#003366',
               fontSize:16}}",
               vAxis="{title:'Quantity of Netflow Passengers',
               titleTextStyle:{color:'#003366',fontSize:16}}",
               width="1000px", height="400px",
               title="Net Flow of Passengers in JUL.2009",
               titleTextStyle="{color:'#003366',fontName:'Arial',
               fontSize:18}",
               legend="{ position:'right'}",
               colors="#6652A3"))


#googlevin plot of month 8
month8_20.Column <- gvisColumnChart(
  month8_20,xvar = "Airport",
  yvar =c("Netflow_Passengers"),
  options=list(hAxis="{title:'Airport',titleTextStyle:{color:'#003366',
               fontSize:16}}",
               vAxis="{title:'Quantity of Netflow Passengers',
               titleTextStyle:{color:'#003366',fontSize:16}}",
               width="1000px", height="400px",
               title="Net Flow of Passengers in AUG.2009",
               titleTextStyle="{color:'#003366',fontName:'Arial',
               fontSize:18}",
               legend="{ position:'right'}",
               colors="#59479C"))

#googlevin plot of month 9
month9_20.Column <- gvisColumnChart(
  month9_20,xvar = "Airport",
  yvar =c("Netflow_Passengers"),
  options=list(hAxis="{title:'Airport',titleTextStyle:{color:'#003366',
               fontSize:16}}",
               vAxis="{title:'Quantity of Netflow Passengers',
               titleTextStyle:{color:'#003366',fontSize:16}}",
               width="1000px", height="400px",
               title="Net Flow of Passengers in SEP.2009",
               titleTextStyle="{color:'#003366',fontName:'Arial',
               fontSize:18}",
               legend="{ position:'right'}",
               colors="#4C3D94"))

#googlevin plot of month 10
month10_20.Column <- gvisColumnChart(
  month10_20,xvar = "Airport",
  yvar =c("Netflow_Passengers"),
  options=list(hAxis="{title:'Airport',titleTextStyle:{color:'#003366',
               fontSize:16}}",
               vAxis="{title:'Quantity of Netflow Passengers',
               titleTextStyle:{color:'#003366',fontSize:16}}",
               width="1000px", height="400px",
               title="Net Flow of Passengers in OCT.2009",
               titleTextStyle="{color:'#003366',fontName:'Arial',
               fontSize:18}",
               legend="{ position:'right'}",
               colors="#332985"))

#googlevin plot of month 11
month11_20.Column <- gvisColumnChart(
  month10_20,xvar = "Airport",
  yvar =c("Netflow_Passengers"),
  options=list(hAxis="{title:'Airport',titleTextStyle:{color:'#003366',
               fontSize:16}}",
               vAxis="{title:'Quantity of Netflow Passengers',
               titleTextStyle:{color:'#003366',fontSize:16}}",
               width="1000px", height="400px",
               title="Net Flow of Passengers in NOV.2009",
               titleTextStyle="{color:'#003366',fontName:'Arial',
               fontSize:18}",
               legend="{ position:'right'}",
               colors="#1A1475"))

#googlevin plot of month 12
month12_20.Column <- gvisColumnChart(
  month12_20,xvar = "Airport",
  yvar =c("Netflow_Passengers"),
  options=list(hAxis="{title:'Airport',titleTextStyle:{color:'#003366',
               fontSize:16}}",
               vAxis="{title:'Quantity of Netflow Passengers',
               titleTextStyle:{color:'#003366',fontSize:16}}",
               width="1000px", height="400px",
               title="Net Flow of Passengers in DEC.2009",
               titleTextStyle="{color:'#003366',fontName:'Arial',
               fontSize:18}",
               legend="{ position:'right'}",
               colors="#000066"))


```


##Analysis the population movement by month 
Zoom into each month data and calculate the netflow of the passengers to explore how the passengers are moving around. For the simplicity and efficience, I select the airports with top 10 and last 10 netflow of passengers in each month. Compared to the following graphs, I find one obvious pattern is that in December, people will travel from North to South area in US, as we see the the Top 3 net inflow passengers are airport MIA(Miami International Airport),FLL(Fort Lauderdale Hollywood International Airport ),MCO(Orlando International Airport),which are all located in Florida, the southmost state.  Meanwhile, the last three airports DCA,ORD and BOS are located at Washington,Chicago and Boston,respectively, which are at the Northern part of US. However, when we check back to the January of the year 2009, the movement is opposite, people are going from Sounth to North of US. In Jan., the first 3 netflow airports are DCA(Ronald Reagan Washington National Airport ),BOS(General Edward Lawrence Logan International Airport) and SFO(San Francisco International Airport) are located at the city of Washington , Boston and San Francisco. While, the last 3 airports with negative netflows are FLL, MCO, MIA,all located at Florida.

```{r merge 12 plots, echo=FALSE, warning=TRUE, results="asis"}
#Merge 12 plots of net flow
month1and2.plot<-gvisMerge(
  month1_20.Column,
  month2_20.Column,
  horizontal=FALSE)
plot(month1and2.plot,'chart')

plot(month3_20.Column,"chart")
plot(month4_20.Column,"chart")
plot(month5_20.Column,"chart")
plot(month6_20.Column,"chart")
plot(month7_20.Column,"chart")
plot(month8_20.Column,"chart")
plot(month9_20.Column,"chart")
plot(month10_20.Column,"chart")
plot(month11_20.Column,"chart")
plot(month12_20.Column,"chart")

```


```{r individualairports, warning=TRUE, include=FALSE, results="asis"}
#subset origin from ewr airport 
ewr_origin<- filter(year2009,Origin=="EWR")
ord_origin<-filter(year2009,Origin=="ORD")
mia_origin<-filter(year2009,Origin=="MIA")
atl_origin<-filter(year2009,Origin=="ATL")
# summarise the number of flights from the origin airport of ewr for each month 
ewr_monthly_outflow <-ewr_origin%>%group_by(Month)%>%
  summarise(Passengers_out=sum(Passengers),flights_out=sum(Flights))

ord_monthly_outflow <-ord_origin%>%group_by(Month)%>%
  summarise(Passengers_out=sum(Passengers),flights_out=sum(Flights))

mia_monthly_outflow <-mia_origin%>%group_by(Month)%>%
  summarise(Passengers_out=sum(Passengers),flights_out=sum(Flights))

atl_monthly_outflow <-atl_origin%>%group_by(Month)%>%
  summarise(Passengers_out=sum(Passengers),flights_out=sum(Flights))

#mean(ord_monthly_outflow$Passengers_out)
#mean(ord_origin$Passengers)
# summarise the number of flights to the desitination airport of ewr for each month 
ewr_destination<-filter(year2009,Destination=="EWR")
ewr_monthly_inflow<-ewr_destination%>%group_by(Month)%>%
  summarise(Passengers_in=sum(Passengers),flights_in=sum(Flights))

ord_destination<-filter(year2009,Destination=="ORD")
ord_monthly_inflow<-ord_destination%>%group_by(Month)%>%
  summarise(Passengers_in=sum(Passengers),flights_in=sum(Flights))

mia_destination<-filter(year2009,Destination=="MIA")
mia_monthly_inflow<-mia_destination%>%group_by(Month)%>%
  summarise(Passengers_in=sum(Passengers),flights_in=sum(Flights))

atl_destination<-filter(year2009,Destination=="ATL")
atl_monthly_inflow<-atl_destination%>%group_by(Month)%>%
  summarise(Passengers_in=sum(Passengers),flights_in=sum(Flights))

#merge the two dataframe into one = ewr 
ewr<-merge(ewr_monthly_inflow,ewr_monthly_outflow,by.x="Month")

ord<-merge(ord_monthly_inflow,ord_monthly_outflow,by.x="Month")

mia<-merge(mia_monthly_inflow,mia_monthly_outflow,by.x="Month")

atl<-merge(atl_monthly_inflow,atl_monthly_outflow,by.x="Month")

# caculate the net flow of passengers for each month
ewr<-mutate(ewr,net_flow=(Passengers_in-Passengers_out))
ord<-mutate(ord,net_flow=(Passengers_in-Passengers_out))
mia<-mutate(mia,net_flow=(Passengers_in-Passengers_out))
atl<-mutate(atl,net_flow=(Passengers_in-Passengers_out))



```

##Analysis the Population Movement by each Airport
The pattern of the passengers netflow also could be analysised by each of the airport. I chose the 4 airports here to disucss to show how the flow of passengers varies during the year.
For the Newark Liberty International Airport, the month 7 is very special, as we see more people leave from New York or New Jersey than come in. May be because the long holiday of independent day. 
But this pattern is not seen in the Chicago ORD airport. There are more people come to Chicago at April and May. 
The above two airport are located at North of the US, so in the winter ,we will see that more people go out to other places. As I analysis before, the people prefer going to Sountern part of US.
The net flow flutuate the most at the month Dec.,of passengers in MIA airport, as there are more people come into Miami from Northen US area.
The last plot, I just want to check how the Atlanta Airport pattern is, because i menthioned before the ATL is the biggiest hub and transit in US, so the net flow of it should not flutuate so strongly.  The flutate is smaller than the other airports menthioned. But it is not visually see , we have to do statictical analysis to prove that the variance is significantly smaller. 

```{r plotnetflow4, echo=FALSE, warning=TRUE, results="asis"}

  
# make plot (problems in Month as x)
#EWR
ewr.plot<-gvisAreaChart(data=ewr,xvar = "Month",
                        yvar=c("net_flow"),
                        options=list(
                          vAxes="[{title:'Netflow of Passengers'}]",
                          title="EWR Airport",
                          legend="{position:'right'}",
                          width="1000px", height="500px",
hAxis="{title:'Month',titleTextStyle:{color:'#003366',
               fontSize:16}}"))
plot(ewr.plot,"chart")

#ORD
ord.plot<-gvisAreaChart(data=ord,xvar = "Month",
                        yvar=c("net_flow"),
                        options=list(
                          vAxes="[{title:'Netflow of Passengers'}]",
                          title="ORD Airport",
                          legend="{position:'right'}",
                          width="1000px", height="500px",
hAxis="{title:'Month',titleTextStyle:{color:'#003366',fontSize:16}}"))
plot(ord.plot,"chart")

#MIA
mia.plot<-gvisAreaChart(data=mia,xvar = "Month",yvar=c("net_flow"),
                 options=list(vAxes="[{title:'Netflow of Passengers'}]",
                              title="MIA Airport",
                              legend="{position:'right'}",
                              width="1000px", height="500px",
hAxis="{title:'Month',titleTextStyle:{color:'#003366',fontSize:16}}"))
plot(mia.plot,"chart")

#ATL
atl.plot<-gvisAreaChart(data=atl,xvar = "Month",
                        yvar=c("net_flow"),
                        options=list(
                          vAxes="[{title:'Netflow of Passengers'}]",
                          title="ATL Airport",
                          legend="{position:'right'}",
                          width="1000px", height="500px",
hAxis="{title:'Month',titleTextStyle:{color:'#003366',fontSize:16}}"))
plot(atl.plot,"chart")

```
