---
title: "ExploratoryVizProject"
output: html_document
---
```{r, echo = FALSE, warning = FALSE, include=FALSE}
library(dplyr)
library(reshape2)
library(scales)
library(plotly)
library(ggthemes)
###--------------------
#THESIS
###-------------------
#show inrease student loan debt
#show increasse average borrowing 
#show increase percent of student borrowing
#show increase percent of that is federal
#show percentage of US assests made up by student loans
#show decrease student loan rates
#show decresing earnings for graduates
#show increassing tuition rates
#compare outstanding student loans to outstanding mortgages
#compare deliquencies rates respectively
#compare volume of MBS and SLABS
#(determine starting events for the trends)
#correlation between loans and delinquency and ABS, then bewteen mortgage and student over similar time frame
#show percentage of bank portfolio made up of MBS and percent of Gov made up of student loans
```

View this project presentation <a href='https://slides.com/sjstebbins/exploratory-data-visualization-project'>HERE</a>

#Are student loans a subprime time-bomb for the US government?

Many of you may be aware that there is an outstanding student loan debt problem in the US. As of 2015, there is 1.3 trillion dollars in outstanding student loan debt and this number has increased steadily over the past 10 years.

```{r, echo = FALSE, warning = FALSE}
##-------------------------------------
##PLOT 1 - Outsanding Student Loan Debt
##-------------------------------------
#total outstanding student loan debt
student_loans_outstanding_df <- read.csv("https://fred.stlouisfed.org/data/SLOAS.csv")
student_loans_outstanding_df <- transmute(student_loans_outstanding_df, Date=DATE, student_loans_outstanding=VALUE)
#convert to trillions
student_loans_outstanding_df$student_loans_outstanding = student_loans_outstanding_df$student_loans_outstanding * 100000
student_loans_outstanding_df$Date = as.Date(student_loans_outstanding_df$Date)
ggplotly(ggplot(student_loans_outstanding_df, aes(x=Date,y=student_loans_outstanding) ) +geom_line( color='red') + ylab("") + ggtitle("Outstanding Student Loan Debt (Dollars)") + scale_x_date(breaks = date_breaks("5 year"), labels = date_format("%Y")) + theme_fivethirtyeight()) 

```

Over the same period, the average debt of graduates has increased to almost $27,000 per graduate and the percentage of graduates with student loan debt has increased to nearly 60%.

```{r, echo = FALSE, warning = FALSE}
state_college_data <- read.csv("./data/CollegeInSight_Explore.csv", stringsAsFactors = FALSE)
#parse state names
state_college_data$Name = gsub(' - 4-year or above', '', state_college_data$Name)
#rename Year column to Date and Name to State
state_college_data <- rename(state_college_data, Date=Year, State=Name)
#convert date to year format
state_college_data$Date = substr(state_college_data$Date,0, nchar(state_college_data$Date) -3)

#student loan deliquencies per state
state_student_loan_delinquencies_data <- read.csv("./data/FRBNY-HDC_STLOANDEL.csv", stringsAsFactors = FALSE)
#melt state column to single column 
state_student_loan_delinquencies_data  <- melt(state_student_loan_delinquencies_data, id= 'Date', variable.name='State', value.name="Percent.student.loan.delinquences")
#convert date to year format
state_student_loan_delinquencies_data$Date = as.character(state_student_loan_delinquencies_data$Date)
state_student_loan_delinquencies_data$Date = substr(state_student_loan_delinquencies_data$Date,0, nchar(state_student_loan_delinquencies_data$Date) -6)

#combine delinquencies with state data frame
state_data <- merge(state_college_data,state_student_loan_delinquencies_data,by=c('Date','State'))

#convert all NA in order to summarize on year
NAs <- state_data == "N/A"
state_data[NAs] <- NA
#convert appropriate to numerics
state_data[,3:11] <- as.numeric(unlist(state_data[,3:11]))

state_data <- select(state_data, -State)
#group by on year and summarize means
data <- state_data %>% group_by(Date) %>% summarise_each(funs(mean(., na.rm = TRUE))) 

##-------------------------------------
##PLOT 2 - Average Student Loan Debt
##-------------------------------------
average_debt <- select(data,Date, Average.debt.of.graduates)
average_debt<- melt(average_debt,id = 'Date', value.name='Amount.in.Thousands')
ggplotly(ggplot(average_debt,aes(x=Date,y=Amount.in.Thousands,group=variable,color=variable)) + geom_line()  + ggtitle('Average Student Loan Debt') + theme(legend.position="none") + theme_fivethirtyeight())
```
<br/>
```{r, echo = FALSE, warning = FALSE}
##-------------------------------------
##PLOT 3 - Percent of Student with Debt
##-------------------------------------
percent_student_with_debt <- select(data,Date, Percent.of.graduates.with.debt)
percent_student_with_debt <- melt(percent_student_with_debt ,id = 'Date', value.name='Percent')
ggplotly(ggplot(percent_student_with_debt , aes(x=Date,y=Percent,group=variable,color=variable)) + geom_line() + ggtitle('Percent of Students with Debt') +  theme(legend.position="none") + theme_fivethirtyeight())
```

###But where is this money coming from?

90% of student loan debt in 2015 was comprised of federal loan borrowing

```{r, echo = FALSE, warning = FALSE}
##-------------------------------------
##PLOT 4 -  Federal Loan Borrowing as Percent of Total Debt
##-------------------------------------
percent_federal_debt <- select(data,Date, Federal.debt.of.graduates..as.percent.of.total.debt)
percent_federal_debt <- melt(percent_federal_debt ,id = 'Date', value.name='Percent')
ggplotly(ggplot(percent_federal_debt , aes(x=Date,y=Percent,group=variable,color=variable)) + geom_line() + ggtitle('Federal Loan Borrowing as Percent of Total Debt') +  theme(legend.position="none") + theme_fivethirtyeight())
```

which accounts for nearly 27% of the US federal government's total assets as reported in the 2015 US Tresury's financial statements. ($845.1B of the $3,229.8B). This is a 3.5% increase since 2014 ($731.2B of $3,065.3B). Although this pails in comparision to the over 21 trillion dollar US deficit, student loans are becoming an ever growing part of the US governments' assets. 


###Is this really a serious problem? 

The short answer is that yes, it could be a very serious problem for a variety of reasons.

  1) Although unemployment rates are stabilizing, many graduates do not go on to have an income that affords the amount of debt they take on from the federal government to attend college and go on to take on higher education that only amplifies this problem
  
  2) Universities have taken advantage of the influx of students and their accessibility to loans and have increased tuition at a rate that far out weighs unemployment recovery and the consumer price index. 
  
```{r, echo = FALSE, warning = FALSE}
##-------------------------------------
##PLOT 5 - Increasing College Costs
##-------------------------------------
increasing_college_costs <- select(data,Date,Total.cost.of.attendance..on.campus.)
increasing_college_costs <- melt(increasing_college_costs,id = 'Date', value.name='Amount.in.Thousands')
ggplotly(ggplot(increasing_college_costs, aes(x=Date,y=Amount.in.Thousands,group=variable,color=variable)) + geom_line() + ggtitle('Average College Costs') + theme(legend.position="none") + theme_fivethirtyeight())
```
  
  3) All student loans are rated AAA, which they cannot possibly be. Because student loan rates have been held so low, federal loan almost always have a lower interest rates than private loans higher interest rates, which promotes borrowers usually prioritize repaying private loans first. Another big difference between federal loans and private loans is that federal loans all have fixed rates, while private loans usually have rates that vary from borrower to borrower based on his or her credit. Unlike private lenders, the federal government doesn’t check credit records for student loan borrowers. This leads to many uncreditworthy borrowers qualifying for loans and then being saddled with debt indefinitely with little hope of paying it back. This has lead to an increasing default rate over the past three years, which surely only brings a portion of the borrowers who can't pay back there loans compared ot many others taking advantage of 
  
  
  
####explain laon forgiveneess and how repayments are delayed

The name “Obama Student Loan Forgiveness” has become the nickname for a program actually called the William D. Ford Direct Loan program. Many people only know about the program, and have heard of it through others as the Obama Student Loan Forgiveness program.The name came about when President Obama reformed part of the Direct Loan program in 2010 by signing the Health Care and Education Reconciliation Act of 2010.

Here are some of the changes that were made by President Obama.

The federal government will no longer give subsidies to private lending institutions for federally backed loans.
Borrowers of new loans starting in 2014 will qualify to make payments based on 10% of their discretionary income.
New borrowers would also be eligible for student loan forgiveness after 20 years instead of 25 on qualifying payments.
Money will be used to fund poor and minority students and increase college funding

####correlate current student loan probelm with mortgage crisis

 This harkens back to the sub-prime housing loans that drove up the housing bubble.

```{r, echo = FALSE, warning = FALSE, include=FALSE}
#-------------------------------------------------------------
#LATER WORK
#-------------------------------------------------------------
# 
# #mortgage debt
# mortgage_debt_outstanding_df <- read.csv("https://fred.stlouisfed.org/data/MDOAH.csv", stringsAsFactors = FALSE)
# mortgage_debt_outstanding_df <- transmute(mortgage_debt_outstanding_df, Date=DATE, mortgage_debt_outstanding=as.numeric(VALUE))
# #convert to trillions
# mortgage_debt_outstanding_df$mortgage_debt_outstanding = mortgage_debt_outstanding_df$mortgage_debt_outstanding * 100
# 
# #join debt outstanding data frames
# debt_df <- join_all(list(mortgage_debt_outstanding_df,student_loans_outstanding_data), by='Date', type = "full")
# #convert date
# debt_df$Date = as.Date(debt_df$Date)
# #melt data on date
# debt_data <- melt(debt_df,id = 'Date', measure.vars = names(select(debt_df, -Date)))
# #plot graph
# ggplotly(ggplot(debt_data, aes(x=Date,y=value,group=variable,color=variable)) + geom_line() + facet_wrap(~variable, scales = "free"))
#   
# #-------------------------------------------------------------
# #compare deliquencies rates respectively
# #-------------------------------------------------------------
# 
# #mortgage delinquencies
# mortgage_delinquencies_df <- read.csv("https://fred.stlouisfed.org/data/DRSFRMACBS.csv")
# mortgage_delinquencies_df <- transmute(mortgage_delinquencies_df, Date=DATE, mortgage_delinquencies=VALUE)
# 
# #join delinquency data frames
# delinquencies_df <- join_all(list(mortgage_delinquencies_df, student_loan_delinquencies_data), by='Date', type = "full")
# #convert date
# delinquencies_df$Date = as.Date(delinquencies_df$Date)
# #melt data on date
# delinquencies_data <- melt(delinquencies_df,id = 'Date', measure.vars = names(select(delinquencies_df, -Date)))
# delinquencies_data <- na.omit(delinquencies_data)
# #plot graph
# ggplotly(ggplot(delinquencies_data, aes(x=Date,y=value,group=variable,color=variable) ) + geom_line() + scale_x_date(breaks = date_breaks("5 year"), labels = date_format("%Y")))
# 
# #-------------------------------------------------------------
# # compare volume of MBS and SLABS
# #-------------------------------------------------------------
# 
# 
# #mortgage rates
# # mortgage_rates_df <- read.csv("~/Documents/NYCDSA/Exploratory Visualization Project/FMAC-MORTG.csv")
# # mortgage_rates_df <- transmute(mortgage_rates_df, date=Date, mortgage_rates=Value)
```





 


